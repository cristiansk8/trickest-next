// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            Int           @id @default(autoincrement())
  email         String        @unique
  password      String? // Contraseña hasheada (opcional para usuarios de Google)
  name          String?
  phone         String? // Campo para el número de celular
  photo         String?
  estado        String?
  departamento  String?
  ciudad        String?
  birthdate     DateTime? // Nuevo campo para la fecha de nacimiento
  birthskate    DateTime? // Nuevo campo para la fecha de nacimiento
  profileStatus String        @default("basic") // "basic" (solo Google) | "complete" (perfil completo)
  role          String        @default("skater") // "skater" | "judge" | "admin"
  isActive      Boolean       @default(true) // Si el usuario está activo
  teamId        Int? // ID del equipo al que pertenece
  createdAt     DateTime      @default(now())
  socials       SocialMedia[] // Relación con la tabla de redes sociales
  WishSkate     WishSkate?
  submissions   Submission[] // Relación con los envíos de trucos
  evaluations   Submission[] @relation("JudgeEvaluations") // Evaluaciones hechas como juez
  ownedTeams    Team[]       @relation("TeamOwner") // Equipos que ha creado
  team          Team?        @relation("TeamMembers", fields: [teamId], references: [id])
}

model SocialMedia {
  id        Int     @id @default(autoincrement())
  userId    String  @unique // Cambiado de Int a String (email del usuario)
  facebook  String?
  instagram String?
  twitter   String?
  tiktok    String?

  user User @relation(fields: [userId], references: [email]) // Relacionado por email
}

model WishSkate {
  id          Int     @id @default(autoincrement())
  userId      String  @unique // Cambiado de Int a String (email del usuario)
  madero      String?
  trucks      String?
  ruedas      String?
  rodamientos String?
  tenis       String?

  user User @relation(fields: [userId], references: [email]) // Relacionado por email
}

model Challenge {
  id          Int          @id @default(autoincrement())
  level       Int // Nivel del reto (1-10, 0 para bonus)
  name        String // Nombre del truco (ej: "Ollie", "Kickflip")
  description String // Descripción del truco
  demoVideoUrl String // URL del video demo (YouTube)
  isBonus     Boolean      @default(false) // Si es un nivel bonus
  difficulty  String // "easy", "medium", "hard", "expert"
  points      Int          @default(100) // Puntos que otorga el truco
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  submissions Submission[] // Relación con los envíos de usuarios

  @@unique([level, isBonus]) // Solo puede haber un challenge por nivel (o un bonus)
}

model Submission {
  id           Int      @id @default(autoincrement())
  userId       String // Email del usuario
  challengeId  Int // ID del reto
  videoUrl     String // URL del video de YouTube del usuario
  status       String   @default("pending") // "pending", "approved", "rejected"
  score        Int? // Puntuación otorgada por el equipo (0-100)
  feedback     String? // Comentarios del equipo evaluador
  submittedAt  DateTime @default(now())
  evaluatedAt  DateTime? // Fecha de evaluación
  evaluatedBy  String? // Email del juez que evaluó

  user      User      @relation(fields: [userId], references: [email])
  challenge Challenge @relation(fields: [challengeId], references: [id])
  judge     User?     @relation("JudgeEvaluations", fields: [evaluatedBy], references: [email])

  @@index([userId, challengeId])
  @@index([status])
  @@index([evaluatedBy])
}

model Team {
  id          Int      @id @default(autoincrement())
  name        String   @unique // Nombre del equipo (único)
  description String? // Descripción del equipo
  logo        String? // URL del logo del equipo
  ownerId     String // Email del creador del equipo
  maxMembers  Int      @default(5) // Máximo de miembros permitidos
  isActive    Boolean  @default(true) // Si el equipo está activo
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  owner   User   @relation("TeamOwner", fields: [ownerId], references: [email])
  members User[] @relation("TeamMembers") // Miembros del equipo

  @@index([ownerId])
  @@index([isActive])
}
